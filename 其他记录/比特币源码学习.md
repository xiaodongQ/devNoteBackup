# 比特币源码学习

* 源代码:[xiaodongQ/bitcoin](https://github.com/xiaodongQ/bitcoin) (从官网fork一份用于注释学习)
	- fork自:[bitcoin/bitcoin](https://github.com/bitcoin/bitcoin)
* 安装
	- bitcoin/doc路径下，有各个平台的安装脚本(build-xxx.md)，按里面要求git clone，而后安装依赖，执行脚本，然后进行编译
	- OSX下安装依赖(已安装的包会自动跳过):`brew install automake berkeley-db4 libtool boost miniupnpc openssl pkg-config python libevent qrencode` (我去掉了qt，不用可视化)
	- 若不去掉钱包功能，则需要安装数据库(若要去掉则`./configure --disable-wallet`进行指定)
		+ 文档中建议Berkeley DB 4.8. 安装：`./contrib/install_db4.sh .`，第一个参数用于指定安装路径
	- `./autogen.sh`后，`./configure --without-gui`，自己的机器上会提示libdb_cxx headers和库找不到
		+ 这时需要将上面安装的Berkeley DB 4.8数据库的`头文件路径`和`链接库路径`添加一下环境变量再进行configure配置和make编译
			* 自己环境的路径如下，xxx/bitcoin是我放源码的路径，数据库安装在本相对路径
			* `export CPLUS_INCLUDE_PATH=/Users/xd/Documents/workspace/src/cpp_path/bitcoin/db4/include`
			* `export LIBRARY_PATH=/Users/xd/Documents/workspace/src/cpp_path/bitcoin/db4/lib`
		+ 查看`make`时Makefile中指定的数据库路径为`-I/usr/local/Cellar/berkeley-db4/4.8.30/include`，是按`brew install berkeley-db4`成功的情况来指定的，不过我的环境安装报错，所以需要上面的环境变量配置(若成功也不需要用install_db4.sh脚本安装数据库)
* 运行
	- 执行文件在 `./src/bitcoind`目录
	- `./src/bitcoind -daemon`以守护进程方式启动程序(一直运行的服务端程序)；
		+ 也可`./`执行，ctrl+C打断
	- `./src/`路径下还有编译好的以下程序：
		+ `bitcoin-wallet`(钱包程序)
		+ `bitcoin-tx`(挖矿)
		+ `bitcoin-cli`(Bitcoin Core RPC客户端)
			* `./src/bitcoin-cli --help` 执行该命令，查看用法
			* `./src/bitcoin-cli help` 当bitcoind程序在运行时执行，查看RPC命令列表